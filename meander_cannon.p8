pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- meander cannon

#include game.lua

function _init()
end

local x = 64
local y = 64

local pi = 3.141592

local rot = 0
local rot_vel = 0 
local rot_acc = 0.5
local rot_vel_max = pi 
local rot_de_acc = -0.1
local len = 12

local dt = 1/30

local cannon = {}
cannon.rot = 0
cannon.pos = {x=65, y=65}
cannon.len = 12
cannon.tip = {x=77, y=65}
cannon.color = 2

function cannon:rotate(d_rot)
 self.rot += d_rot
 local nx = cos(self.rot) * self.len
 local ny = -sin(self.rot) * self.len
 self.tip = {x=nx+self.pos.x, y=ny+self.pos.y}
end

function cannon:draw()
 plot_line(self.pos, self.len, self.rot, self.color)
 circfill(self.tip.x, self.tip.y, 2, self.color)
end

function print_table(t)
 for k,v in pairs(t) do
  print(k..":"..v.." ")
 end
end

-- Draw the 128x128 frame of the window in a given color
function draw_frame(color)
 rect(0, 0, 127, 127, color)
end

local fire = false
local cannonballs = {}

function _update()
 -- if btn(0) then rot -= 0.01 end
 -- if btn(1) then rot += 0.01 end
 if btn(0) then cannon:rotate(-0.01) end
 if btn(1) then cannon:rotate(0.01)  end

 if btnp(5) then fire = true end
 if fire then 
  fire = false
 end

end

function create_line(pos, len, rot)
 local ret = {}
 ret.x0 = pos.x
 ret.y0 = pos.y
 ret.x1 = len * cos(rot) + pos.x
 ret.y1 = -len * sin(rot) + pos.y

 return ret
end

function plot_line(pos, len, rot, color)
 local p = create_line(pos, len, rot)
 -- print_table(p)
 line(p.x0, p.y0, p.x1, p.y1, color)
end

function _draw()
 cls()
 draw_frame(1)
 -- pset(x, y, 2)
 spr(0, 57, 57, 2, 2)
 -- line(63, 63)
 cannon:draw()
 
end

__gfx__
00000767667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077666666ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0076666666666f000099a80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07666666666666f0009aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07666666666666f000aaa90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7666666666666665008a990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d666666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d666666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d66666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd666666550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
